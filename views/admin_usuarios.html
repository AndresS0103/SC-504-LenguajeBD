<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AdminLTE 3 | Starter</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <link rel="stylesheet" href="./assets/css/usuarios.css">
</head>

<body class="hold-transition sidebar-mini">
  <div class="wrapper">

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="index.html" class="nav-link">INICIO</a>
        </li>
      </ul>
    </nav>

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="index3.html" class="brand-link">
        <img src="dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
          style="opacity: .8">
        <span class="brand-text font-weight-light">JAFRA ADMIN</span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar user panel (optional) -->

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
            <li class="nav-item menu-open">
              <a href="#" class="nav-link active">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <p>
                  Monitoreo
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="admin.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Inventario</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="admin_usuarios.html" class="nav-link active">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Usuarios</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="admin_facturas.html" class="nav-link ">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Facturas</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a href="index.html" class="nav-link">
                <i class="nav-icon fas fa-th"></i>
                <p>
                  Volver a la tienda
                </p>
              </a>
            </li>
          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->

      <!--MOSTRAR USUARIOS-->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1>Lista de Usuarios</h1>
              <ul id="usuarios-list">
              </ul>





              <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <div class="content-header">
                  <div class="container-fluid">
                    <div class="row mb-2">
                      <div class="col-sm-6">
                        <h1>Crear Usuario</h1>
                        <!-- Formulario para crear usuario -->
                        <div class="form-wrapper">
                          <form id="form-insertar-usuario" method="post" action="/usuariosInsertar">
                            <!-- Campos del usuario -->
                            <label for="id_usuario">ID Usuario:</label>
                            <input type="number" id="id_usuario" name="id_usuario" required><br>
                            <label for="nombre">Nombre:</label>
                            <input type="text" id="nombre" name="nombre" required><br>
                            <label for="prim_apellido">Primer Apellido:</label>
                            <input type="text" id="prim_apellido" required><br>
                            <label for="seg_apellido">Segundo Apellido:</label>
                            <input type="text" id="seg_apellido" required><br>
                            <label for="cedula">Cédula:</label>
                            <input type="number" id="cedula" required><br>
                            <label for="rol">Rol:</label>
                            <input type="text" id="rol" required><br>
                            <label for="telefono_usuario">Teléfono:</label>
                            <input type="text" id="telefono_usuario" required><br>
                            <label for="correo">Correo:</label>
                            <input type="email" id="correo" required><br>
                            <!-- Botón para enviar usuario -->
                            <input type="submit" value="Crear Usuario">
                          </form>
                        </div>
                        <!-- Botón para ver facturas -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <script>
                document.addEventListener('DOMContentLoaded', function () {
                  // Agregar evento al formulario para insertar usuario
                  document.getElementById('form-insertar-usuario').addEventListener('submit', async function (event) {
                    event.preventDefault(); // Evitar el envío del formulario por defecto

                    // Obtener los datos del formulario
                    const id_usuario = document.getElementById('id_usuario').value;
                    const nombre = document.getElementById('nombre').value;
                    const prim_apellido = document.getElementById('prim_apellido').value;
                    const seg_apellido = document.getElementById('seg_apellido').value;
                    const cedula = document.getElementById('cedula').value;
                    const rol = document.getElementById('rol').value;
                    const telefono_usuario = document.getElementById('telefono_usuario').value;
                    const correo = document.getElementById('correo').value;

                    try {
                      // Enviar solicitud POST para insertar usuario
                      const response = await fetch('/usuariosInsertar', {
                        method: 'POST',
                        headers: {
                          'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                          id_usuario,
                          nombre,
                          prim_apellido,
                          seg_apellido,
                          cedula,
                          rol,
                          telefono_usuario,
                          correo
                        })
                      });

                      // Verificar si la solicitud fue exitosa
                      if (response.ok) {
                        // Limpiar el formulario después de la inserción
                        document.getElementById('form-insertar-usuario').reset();
                        alert('Usuario insertado correctamente.');
                        // Actualizar la lista de usuarios después de la inserción
                        await actualizarListaUsuarios();
                      } else {
                        // Mostrar mensaje de error si la solicitud falla
                        const errorMessage = await response.json();
                        alert('Error al insertar usuario: ' + errorMessage.error);
                      }
                    } catch (error) {
                      console.error('Error al insertar usuario:', error);
                      alert('Error al insertar usuario.');
                    }
                  });
                });

                async function actualizarListaUsuarios() {
                  try {
                    // Obtener la lista de usuarios desde el servidor
                    const response = await fetch('/usuarios');
                    const usuarios = await response.json();
                    // Limpiar la lista actual de usuarios
                    const usuariosList = document.getElementById('usuarios-list');
                    usuariosList.innerHTML = '';
                    // Llenar la lista con los nuevos usuarios obtenidos
                    usuarios.forEach(usuario => {
                      const listItem = document.createElement('li');
                      listItem.textContent = `${usuario[0]}: ${usuario[1]} ${usuario[2]} ${usuario[3]}`;
                      usuariosList.appendChild(listItem);
                    });
                  } catch (error) {
                    console.error('Error al obtener los usuarios:', error);
                    alert('Error al obtener los usuarios.');
                  }
                }

              </script>

              <!--${usuario[0]}: ${usuario[1]} ${usuario[2]} ${usuario[3]}-->

              <script>

                fetch('/usuarios')
                  .then(response => response.json())
                  .then(usuarios => {
                    const usuariosList = document.getElementById('usuarios-list');
                    usuarios.forEach(usuario => {
                      const listItem = document.createElement('li');
                      listItem.textContent = `${usuario[0]}: ${usuario[1]} ${usuario[2]} ${usuario[3]}`;
                      usuariosList.appendChild(listItem);
                    });
                  })
                  .catch(error => {
                    console.error('Error al obtener los usuarios:', error);
                  });
              </script>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
    </div>

    <!-- REQUIRED SCRIPTS -->

    <!-- jQuery -->
    <script src="plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/adminlte.min.js"></script>
</body>

</html>